<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Start in dark mode by default -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{SITE_TITLE}}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Simple scrollbar styling for a more modern look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans antialiased">

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white tracking-tight">Loudoun Velo</h1>
            <p class="mt-3 text-lg text-gray-400 max-w-2xl mx-auto">A curated collection of the best local cycling routes in and around Loudoun County, Virginia.</p>
        </header>

        <!-- Controls Section -->
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-12">
            <div class="relative">
                 <select id="type-filter" class="appearance-none w-48 bg-gray-800 border border-gray-700 text-white rounded-lg py-2 px-4 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    <option value="all">All Route Types</option>
                    <option value="road">Road</option>
                    <option value="gravel">Gravel</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>
            <button id="unit-toggle" class="w-48 bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
                Switch to km/m
            </button>
        </div>

        <!-- Routes Grid -->
        <div id="routes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8">
            <!-- Route cards will be injected here by JavaScript -->
        </div>

    </div>

    <script>
        // This line could cause a syntax error if the template is viewed directly in a browser
        // without the build script replacing the placeholder.
        const routesDataJSON = `{{ROUTES_DATA}}`;
        let routesData = [];

        // This approach prevents the syntax error. If the placeholder isn't replaced,
        // it remains a string and the script doesn't crash.
        if (routesDataJSON.startsWith('[')) {
            try {
                routesData = JSON.parse(routesDataJSON);
            } catch (e) {
                console.error("Error parsing routes data:", e);
                // Fallback to an empty array if JSON is malformed
                routesData = [];
            }
        }
        
        // Default to imperial units (miles/feet)
        let useMetric = localStorage.getItem("useMetric") === "true";
        // Default filter is 'all'
        let filterType = localStorage.getItem("filterType") || "all";

        function initializeControls() {
            document.getElementById("unit-toggle").textContent = useMetric ? "Switch to mi/ft" : "Switch to km/m";
            document.getElementById("type-filter").value = filterType;
        }

        // Helper functions to format distance and elevation
        function formatDistance(km) {
            if (km === null || typeof km === 'undefined') return "?";
            return useMetric ? `${km.toFixed(1)} km` : `${(km * 0.621371).toFixed(1)} mi`;
        }

        function formatElevation(m) {
            if (m === null || typeof m === 'undefined') return "?";
            return useMetric ? `${Math.round(m)} m` : `${Math.round(m * 3.28084)} ft`;
        }

        function renderRoutes() {
            const container = document.getElementById("routes-container");
            container.innerHTML = ""; // Clear existing routes

            const filteredRoutes = routesData.filter(route => 
                filterType === "all" || route.type === filterType
            );

            if (filteredRoutes.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center text-gray-400 py-16">
                    <h3 class="text-xl font-medium">No routes found for this filter.</h3>
                    <p class="mt-2">Try selecting a different route type.</p>
                </div>`;
                return;
            }

            filteredRoutes.forEach(route => {
                const card = document.createElement("a");
                card.href = route.rwgpsUrl;
                card.target = "_blank";
                card.rel = "noopener noreferrer";
                card.className = "route-card group relative aspect-[4/5] rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 ease-in-out transform hover:-translate-y-1";

                const badgeClass = route.type === "gravel" ? "bg-green-600" : "bg-blue-600";
                
                // Note: The onerror handler provides a fallback image in case the RideWithGPS image fails to load.
                card.innerHTML = `
                    <!-- Background Image -->
                    <img src="${route.image}" alt="Map of ${route.title}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" onerror="this.onerror=null;this.src='https://placehold.co/400x500/020617/334155?text=Map+Not+Found';">
                    
                    <!-- Gradient Overlay -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent"></div>
                    
                    <!-- Content -->
                    <div class="relative flex flex-col justify-end h-full p-5 text-white">
                        <span class="absolute top-4 right-4 text-xs font-semibold uppercase tracking-wider py-1 px-3 rounded-full ${badgeClass}">
                            ${route.type}
                        </span>
                        
                        <h2 class="text-xl font-bold leading-tight mb-2 group-hover:text-blue-400 transition-colors">${route.title}</h2>
                        
                        <div class="flex items-center space-x-4 text-sm text-gray-300">
                            <span class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1.5"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg> <!-- Placeholder for route icon -->
                                ${formatDistance(route.distance)}
                            </span>
                            <span class="flex items-center">
                               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1.5"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path><path d="M13 13l6 6"></path></svg> <!-- Placeholder for elevation icon -->
                                ${formatElevation(route.elevation)}
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Event Listeners
        document.getElementById("unit-toggle").addEventListener("click", () => {
            useMetric = !useMetric;
            localStorage.setItem("useMetric", useMetric);
            initializeControls();
            renderRoutes();
        });

        document.getElementById("type-filter").addEventListener("change", (e) => {
            filterType = e.target.value;
            localStorage.setItem("filterType", filterType);
            renderRoutes();
        });

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeControls();
            renderRoutes();
        });

    </script>

</body>
</html>